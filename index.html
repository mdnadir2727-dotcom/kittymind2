<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>KittyMind</title>

<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">
<link rel="stylesheet" href="style.css">
</head>

<body class="flex flex-col h-screen w-full">

<div class="mesh-gradient">
    <div class="blob bg-rose-200 w-[60%] h-[60%] -top-[10%] -left-[10%]"></div>
    <div class="blob bg-[#DFF7F2] w-[60%] h-[60%] -bottom-[10%] -right-[10%]"></div>
</div>

<header class="z-10 flex items-center justify-between px-6 py-4 glass border-b">
    <h1 class="text-xl font-extrabold text-slate-800 tracking-tight">KittyMind</h1>
</header>

<main class="flex-1 relative flex flex-col items-center justify-center overflow-hidden">
    <div id="chatHistory" class="absolute right-6 bottom-32 w-80 max-h-[40vh] z-10 hidden lg:flex flex-col gap-3 overflow-y-auto no-scrollbar px-2"></div>
</main>

<footer class="z-20 p-6 flex flex-col items-center">
    <div class="w-full max-w-2xl glass rounded-[32px] p-2 shadow-2xl">
        <div class="flex items-center gap-2">
            <input id="chatInput" type="text" placeholder="Ask me anything, meow..." class="flex-1 bg-transparent py-4 outline-none text-slate-700 font-medium">
            <button id="sendBtn" class="p-4 rounded-2xl bg-rose-400 text-white transition-all shadow-md hover:bg-rose-500 active:scale-95">
                Send
            </button>
        </div>
    </div>
</footer>

<script>
const chatInput = document.getElementById('chatInput');
const sendBtn = document.getElementById('sendBtn');
const chatHistory = document.getElementById('chatHistory');

async function handleSend() {
    const text = chatInput.value.trim();
    if (!text) return;

    addMessage('user', text);
    chatInput.value = '';

    try {
        const response = await fetch('/api/chat', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ message: text })
        });

        const data = await response.json();
        addMessage('assistant', data.reply);
    } catch (err) {
        addMessage('assistant', "Oopsie! Something went wrong ğŸ¾");
    }
}

function addMessage(role, content) {
    const div = document.createElement('div');
    div.className = role === 'user'
        ? "chat-bubble p-4 rounded-3xl text-sm bg-rose-400 text-white ml-auto"
        : "chat-bubble p-4 rounded-3xl text-sm text-slate-700 mr-auto glass";
    div.innerText = content;
    chatHistory.appendChild(div);
    chatHistory.scrollTop = chatHistory.scrollHeight;
}

sendBtn.addEventListener('click', handleSend);
chatInput.addEventListener('keydown', e => e.key === 'Enter' && handleSend());
</script>

</body>
</html>